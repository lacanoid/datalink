\pset null _null_
SET client_min_messages = warning;
SET search_path=datalink;
select dlvalue('http://www.ljudmila.org');
              dlvalue               
------------------------------------
 {"url": "http://www.ljudmila.org"}
(1 row)

select dlvalue('http://www.ljudmila.org','URL','Example datalink');
                            dlvalue                             
----------------------------------------------------------------
 {"url": "http://www.ljudmila.org", "text": "Example datalink"}
(1 row)

select dlvalue('/tmp','FS','Example file datalink');
                         dlvalue                         
---------------------------------------------------------
 {"url": "file:///tmp", "text": "Example file datalink"}
(1 row)

select dlvalue('file:///tmp','URL','Example file datalink #2');
                          dlvalue                           
------------------------------------------------------------
 {"url": "file:///tmp", "text": "Example file datalink #2"}
(1 row)

select dlcomment(dlvalue('http://www.ljudmila.org','URL','Example datalink'));
    dlcomment     
------------------
 Example datalink
(1 row)

select dlurlcomplete(dlvalue('http://www.ljudmila.org','URL','Example datalink'));
      dlurlcomplete      
-------------------------
 http://www.ljudmila.org
(1 row)

select dlurlcompleteonly(dlvalue('http://www.ljudmila.org','URL','Example datalink'));
    dlurlcompleteonly    
-------------------------
 http://www.ljudmila.org
(1 row)

select dlnewcopy(dlvalue('http://www.ljudmila.org'),0);
             dlnewcopy              
------------------------------------
 {"url": "http://www.ljudmila.org"}
(1 row)

select (dlnewcopy(dlvalue('http://www.ljudmila.org'),1))->>'token' is not null;
 ?column? 
----------
 t
(1 row)

select dlpreviouscopy(dlvalue('http://www.ljudmila.org'),0);
           dlpreviouscopy           
------------------------------------
 {"url": "http://www.ljudmila.org"}
(1 row)

select (dlpreviouscopy(dlvalue('http://www.ljudmila.org'),1))->>'token' is not null;
 ?column? 
----------
 t
(1 row)

select dl_lco(link_control=>'FILE');
 dl_lco 
--------
      1
(1 row)

select dl_lco(link_control=>'FILE',integrity=>'ALL',read_access=>'DB',write_access=>'BLOCKED');
 dl_lco 
--------
   1121
(1 row)

select * from link_control_options(dl_lco(link_control=>'NO'));
 lco | link_control | integrity | read_access | write_access | recovery | on_unlink 
-----+--------------+-----------+-------------+--------------+----------+-----------
   0 | NO           | NONE      | FS          | FS           | NO       | NONE
(1 row)

select * from link_control_options(dl_lco(link_control=>'FILE',integrity=>'SELECTIVE'));
 lco | link_control | integrity | read_access | write_access | recovery | on_unlink 
-----+--------------+-----------+-------------+--------------+----------+-----------
  11 | FILE         | SELECTIVE | FS          | FS           | NO       | NONE
(1 row)

select * from link_control_options(dl_lco(link_control=>'FILE',integrity=>'ALL'));
 lco | link_control | integrity | read_access | write_access | recovery | on_unlink 
-----+--------------+-----------+-------------+--------------+----------+-----------
  21 | FILE         | ALL       | FS          | FS           | NO       | NONE
(1 row)

select * from link_control_options(dl_lco(link_control=>'FILE',integrity=>'ALL',
					  read_access=>'DB',write_access=>'BLOCKED',
					  recovery=>'YES',on_unlink=>'DELETE'));
  lco   | link_control | integrity | read_access | write_access | recovery | on_unlink 
--------+--------------+-----------+-------------+--------------+----------+-----------
 211121 | FILE         | ALL       | DB          | BLOCKED      | YES      | DELETE
(1 row)

select * from link_control_options(dl_lco(link_control=>'FILE',integrity=>'ALL',
					  read_access=>'DB',write_access=>'BLOCKED',
					  recovery=>'YES',on_unlink=>'RESTORE'));
  lco   | link_control | integrity | read_access | write_access | recovery | on_unlink 
--------+--------------+-----------+-------------+--------------+----------+-----------
 111121 | FILE         | ALL       | DB          | BLOCKED      | YES      | RESTORE
(1 row)

select dlurlserver(dlvalue('http://www.ljudmila.org/foo/bar/baz#123'));
   dlurlserver    
------------------
 www.ljudmila.org
(1 row)

select dlurlscheme(dlvalue('http://www.ljudmila.org/foo/bar/baz#123'));
 dlurlscheme 
-------------
 http
(1 row)

select dlurlpath(dlvalue('http://www.ljudmila.org/foo/bar/baz#123'));
  dlurlpath   
--------------
 /foo/bar/baz
(1 row)

select dlurlpathonly(dlvalue('http://www.ljudmila.org/foo/bar/baz#123'));
 dlurlpathonly 
---------------
 /foo/bar/baz
(1 row)

select dllinktype(dlvalue('http://www.ljudmila.org/foo/bar/baz#123'));
 dllinktype 
------------
 URL
(1 row)

select dllinktype(dlvalue('/etc/passwd','FS'));
 dllinktype 
------------
 FS
(1 row)

\x
with a as (
  select 'http://ziga:pass@www.ljudmila.org:8888/foo/bar/baz.qux?a=1&b=2#x123' as uri
)
select
 uri,
 uri_get(uri,'scheme') as scheme,
 uri_get(uri,'authority') as authority,
 uri_get(uri,'userinfo') as userinfo,
 uri_get(uri,'host') as host,
 uri_get(uri,'port') as port,
 uri_get(uri,'host_port') as host_port,
 uri_get(uri,'domain') as domain,
 uri_get(uri,'path') as path,
 uri_get(uri,'dirname') as dirname,
 uri_get(uri,'basename') as basename,
 uri_get(uri,'path_query') as path_query,
 uri_get(uri,'query') as query,
 uri_get(uri,'query_form') as query_form,
 uri_get(uri,'query_keywords') as query_keywords,
 uri_get(uri,'fragment') as fragment,
 uri_get(uri,'token') as token,
 uri_get(uri,'canonical') as canonical
from a;
-[ RECORD 1 ]--+--------------------------------------------------------------------
uri            | http://ziga:pass@www.ljudmila.org:8888/foo/bar/baz.qux?a=1&b=2#x123
scheme         | http
authority      | ziga:pass@www.ljudmila.org:8888
userinfo       | ziga:pass
host           | www.ljudmila.org
port           | 8888
host_port      | www.ljudmila.org:8888
domain         | ljudmila.org
path           | /foo/bar/baz.qux
dirname        | /foo/bar
basename       | baz.qux
path_query     | /foo/bar/baz.qux?a=1&b=2
query          | a=1&b=2
query_form     | 4
query_keywords | _null_
fragment       | x123
token          | x123
canonical      | http://ziga:pass@www.ljudmila.org:8888/foo/bar/baz.qux?a=1&b=2#x123

 
